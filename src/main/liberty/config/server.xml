<server description="Sample Liberty server">

  <featureManager>
      <feature>microprofile-1.2</feature>
      <feature>openidConnectServer-1.0</feature>
      <feature>jwt-1.0</feature>
      <feature>appSecurity-2.0</feature>
      <feature>ssl-1.0</feature>
  </featureManager>

  <httpEndpoint httpPort="${default.http.port}" httpsPort="${default.https.port}"
      id="defaultHttpEndpoint" host="*" />

  <!-- Automatically expand WAR files and EAR files -->
  <applicationManager autoExpand="true"/>

  <webApplication name="Auth" location="${app.location}"/>

  <basicRegistry id="basic" realm=" OpBasicRealm ">
        <user name="foo" password="bar" />
        <user name="user" password="password" />
        <group name="Admin">
          <member name="user" />
       </group>
       <group name="User">
          <member name="foo" />
       </group>
  </basicRegistry>

  <keyStore id="defaultKeyStore" password="keypass" />
  
  <openidConnectProvider id="OP" oauthProviderRef="Oauth" signatureAlgorithm="RS256" keyStoreRef="defaultKeyStore" keyAliasName="default"/>
  <oauthProvider httpsRequired="true" id="Oauth" tokenFormat="mpjwt"  >

    <localStore>
    <client name="bluecomputeweb" secret="bluecomputewebs3cret"
                displayname="bluecomputeweb"
                grant_types="password"
                scope="openid admin blue"
                preAuthorizedScope="openid admin blue"
                enabled="true"
                mapIdentityToRegistryUser="true">
                
    <redirect>https://localhost:8443/oidcclient/redirect/bluecomputeweb</redirect>
    <redirect>http://localhost:9083/oidcclient/redirect/bluecomputeweb</redirect>
    </client>
    </localStore>
  </oauthProvider>
   <oauth-roles>
    <authenticated>
        <special-subject type="ALL_AUTHENTICATED_USERS" />
    </authenticated>
  </oauth-roles>

  <mpJwt id="jwtConsumer"
    jwksUri="https://localhost:9443/oidc/endpoint/OP/jwk"
    issuer="https://localhost:9443/oidc/endpoint/OP"/>

  <jwtBuilder id="jwtBuilder" signatureAlgorithm="HS256"
      issuer="https://github.com/ibm-cloud-architecture/refarch-cloudnative-auth/"
      sharedKey="testKey"
      />

</server>
